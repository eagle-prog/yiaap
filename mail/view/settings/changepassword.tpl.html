<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<head>
<link rel="stylesheet" href="style.css" type="text/css" media="screen" />
<link rel="shortcut icon" type="image/x-icon" href="/mail/favicon.ico">
<style type="text/css">
  .coloum200.floatL {
    margin-top: 5px !important;
}
</style>

<script type="text/javascript" language="javascript">

function passwordStrength(password)

{

        var desc = new Array();

        desc[0] = "{cfn:getmessage(291)}";

        desc[1] = "{cfn:getmessage(292)}";
        
        desc[2] = "{cfn:getmessage(293)}";

        desc[3] = "{cfn:getmessage(294)}";
        
  		desc[4] = "{cfn:getmessage(295)}";


        var score   = 0;

var val=0;
  var s="{$username}";
  if(s==password)
  {
  score=0;
   document.getElementById("pwdcnt").value=0;   
  document.getElementById("passwordDescription").className ="errordisplay";
   document.getElementById("passwordDescription").innerHTML ="{cfn:getmessage(355)}";
   document.getElementById("passwordStrength").className = "strength1";
  }
  else
  {    
var lower=getlower_count(password);
  var upper=getupper_count(password); 
var num_count=getnumber_count(password);
var special=getspecialch_count(password);
var total=lower+upper+num_count+special;
var length=password.length;
if(length==0)
document.getElementById("pwdcnt").value=0;

var min_passwordlength="{$min_passwordlength}";
if(min_passwordlength==1)
{
if(length<1)
	score=0;
	else if(length==1)
	score=1;
	else if(length==2)
	score=2;
	else if(length==3)
	score=3;
	else if(length>3)
	score=4;
}
else if(min_passwordlength==2)
{
	if(total<2 || length<3)
	score=0;
	else if(total==2 && length==3)
	score=1;
	else if(total<=3 && length>3)
	score=2;
	else if(total<=5 && length>=4)
	score=3;
	else if(length<32 && total>5)
	score=4;
}
else if(min_passwordlength==3)
{
	if(total<3 || length<5)
	score=0;
	else if(total==3 && length==5)
	score=1;
	else if(total<=4 && length>5)
	score=2;
	else if(total<=6 && length>=5)
	score=3;
	else if(length<32 && total>7)
	score=4;
}
else if(min_passwordlength==4)
{
	/*if(total<8 || length<6)
	score=0;
	else if(total==8 && length==6)
	score=1;
	else if(total<=9 && length>7)
	score=2;
	else if(total<=12 && length>=7)
	score=3;
	else if(length<32 && total>13)
	score=4;*/
if(length<8)
	score=0;
	else if(length>=8)
	{
	   // if(lower==0 || upper==0 || num_count==0 || special==0 )
	    //score=0;
	    //else
	    score=4;
	}
	else
	{
	}
}
document.getElementById("passwordDescription").className ="passwordstrength_details";

       document.getElementById("passwordDescription").innerHTML = desc[score];
document.getElementById("pwdcnt").value=score;
document.getElementById("passwordStrength").className = "strength" + score;
}
}
function checkpasswordStrength()

{
    //alert("ssss");
var checkscore=document.getElementById("pwdcnt").value;
//alert(checkscore);
if(checkscore==0)
{
    //alert("Password must contain a minimum of  8 characters and must include alteast  1 special character,1 numeric,1 uppercase,1 lowercase.Please re-enter password again");
alert("Password must contain a minimum of  8 characters. Please re-enter password again");
 document.getElementById("password").value='';  
 document.getElementById("cpassword").value='';
 var f=document.getElementById("password");
 f.focus();
}
}
function getlower_count(password)
{
if ( password.match(/[a-z]/))
return 1;
else
return 0;
}
function getupper_count(password)
{
if (password.match(/[A-Z]/) )
return 1;
else
return 0;
}
function getnumber_count(password)
{
 

var numbers = new  Array()

 var l=0;
for(var x = 0,length = password.length; x < length; x++)
 {
    var s = password.charAt(x);
    var flag=0;
    if (isInteger(s))
    {
   
    for(var j=0;j<numbers.length;j++)
    {
   
    if(s==numbers[j])
    {
    flag=1;
   
   
    }
   
   
    }
    if(flag==0)
    {
   
    numbers[l]=s;l++;
    }
   
   
}
var t=numbers[l];

}
var v=numbers.length;
if(v>=3)
return 2;
else if(v==2)
return 1;
else if(v==1)
return 1;
else
return 0;
}
function getspecialch_count(password)
{
 

var special = new  Array()

 var l=0;
for(var x = 0,length = password.length; x < length; x++)
 {
    var s = password.charAt(x);
    var flag=0;
    if (isSpclChar(s) )
    {

    for(var j=0;j<special.length;j++)
    {
   
    if(s==special[j])
    {
    flag=1;
   
   
    }
   
   
    }
    if(flag==0)
    {
   
    special[l]=s;l++;
    }
   
   
}


}
var v=special.length;

return v;
}

function isSpclChar(s){
var iChars = "!@#$%^&*()+=-[]\\\';,./{}|\":<>?";
                for (var i = 0; i < s.length; i++) {
                                if (iChars.indexOf(s.charAt(i)) != -1) {
                              
                                return true;
                }
                else
                return false;
                                }
}




function isInteger(val)
                {
                   // alert(val.value);
                  if(val==null)
                    {
                    //alert(val);
                    return false;
                    }
                if (val.length==0)
                    {
                   // alert(val);
                    return false;
                    }
                 if (trim(val).length == 0)
                     {
                     return false;
                     }
                for (var i = 0; i < val.length; i++)
                    {
                    var ch = val.charAt(i)
                    if (i == 0 && ch == "-")
                        {
                        continue
                        }
                    if (ch < "0" || ch > "9")
                        {
                        return false
                        }
                    }
                return true
            }
            
function messageview()
{

var s="{$msg}";
if(s!="")
{
	parent.notify_display(s,"info");

//document.getElementById("msgviewed").style.display="";
//setTimeout("doSomething()",5000);
}
}
function doSomething() 
    {
       document.getElementById('msgviewed').style.display = 'none';
    }
</script>
</head>
<body onLoad="messageview()">
{if($portal_status==0)}
{formstart:changepassword:{url:(settings/changepassword)}:post}
 <div class="messageTab" id="msgviewed" style="display: none;padding-left: 30px;padding-top: 5px;" align="center">
<span class="messageTabL"></span>
<span class="messageTabM">{$msg}</span>
<span class="messageTabR"></span>
</div>

<div class="mailoptions_details_table">
<div style="padding-bottom:30px;padding-top:0px;" valign="top"><font class="info_title">{cfn:getmessage(469)}</font></div>

<div class="row marginT10">
	<div class="coloum200 floatL"  ><span class="boldTxt">{cfn:getmessage(115)} </span></div>
	<div class="coloum floatL"  >
		<div class="normalTxt marginL10"><input type="password"  name="password1"><strong><span class="mandatory">*</span></strong><input type="hidden" name="pwdcnt" id="pwdcnt" value="">  </span>
		</div>
	</div>
</div>
<div class="row marginT10">
	<div class="coloum200 floatL"  ><span class="boldTxt">{cfn:getmessage(116)} </span></div>
	<div class="coloum floatL"  >
		<div class="normalTxt marginL10"><input type="password" value="" name="npassword" id="password" onKeyUp="passwordStrength(this.value)"><strong><span class="mandatory">*</span></strong>  </span>
		</div>
	</div>
</div>

 <div class="row marginT10">
	<div class="coloum200 floatL"  ><span class="boldTxt"> &nbsp;</span></div>
	<div class="coloum floatL"  >
		<div class="normalTxt marginL10"> <label for="passwordStrength" class="passwordstrength_details">{cfn:getmessage(296)}</label><div id="passwordDescription" class="passwordstrength_details">{cfn:getmessage(297)}</div><div id="passwordStrength" class="strength0"></div> </span>
		</div>
	</div>
</div>


<div class="row marginT10">
	<div class="coloum200 floatL"  ><span class="boldTxt">{cfn:getmessage(117)} </span></div>
	<div class="coloum floatL"  >
		<div class="normalTxt marginL10"><input type="password" value="" name="cpassword" id="cpassword" onKeyUp="checkpasswordStrength();"><strong><span class="mandatory">*</span></strong>  </span>
		</div>
	</div>
</div>

<div class="row marginT10">
	<div class="coloum200 floatL"  ><span class="boldTxt"><input  type="submit" value="{cfn:getmessage(79)}" name="update" class="cursor_select"></span></div>
	<div class="coloum floatL"  >
		<div class="normalTxt marginL10"><input type="hidden" name="uid" value="{$uid}" />  </span>
		</div>
	</div>
</div>


</div>


{validate:changepassword:isNotNull("password1",{cfn:getmessage(104)})}
{validate:changepassword:isNotNull("npassword",{cfn:getmessage(119)})}
{validate:changepassword:isNotNull("cpassword",{cfn:getmessage(118)})}

{formend:changepassword}
{endif}
</body>
</html>
<script type="text/javascript">

parent.showPreloadDiv();
parent.showPreloadDivGif();
</script>
