/*
* freepaper2.js
* franck ruzzin
* le 28 août 2011
*/

m_freepaper2_swfUrl=_base + "/f_modules/m_frontend/m_player/swf/freepaper.swf";		//Chemin et nom vers le fichier swf "freepaper"
m_freepaper2_phpURL="";			//URL du script PHP freepaper.php

freepaper2Obj={freepaperArray:new Array(),xmlArray:new Array(),embedDoc:function(b,f,c){myFreepaper=new Object;myFreepaper.isReady=false;myFreepaper.trace=c.trace;if(!f.width){f.width=600}if(!f.height){f.height=800}if(!c.altContentId){c.altContentId="freepaper1"}c.id=c.altContentId+"_ready";b.playerId=c.id;c.name=c.altContentId;this.freepaperArray[c.altContentId]=myFreepaper;var d=document.getElementById(c.altContentId);var a=f.height.toString();if((a.indexOf("%")==-1)&&(a.indexOf("px")==-1)){d.style.height=f.height+"px"}else{d.style.height=f.height}a=f.width.toString();if((a.indexOf("%")==-1)&&(a.indexOf("px")==-1)){d.style.width=f.width+"px"}else{d.style.width=f.width}if(b.docURL.substr(b.docURL.length-3).toUpperCase()=="SWF"){if((c.trace=="true")||(c.trace==true)){alert("Open input file :\n"+b.docURL)}this.display(b,f,c)}else{var e=this.getXhr();if(!e){throw new Error("Can't open an xhr session !")}e.onreadystatechange=function(){if(e.readyState==4){if(e.status==200){if((c.trace=="true")||(c.trace==true)){alert(e.responseText)}if(e.responseText.lastIndexOf("EXEC RETURN VALUE : 0")>-1){b.docURL+=".swf"}else{if((!c.trace)||(c.trace=="auto")){alert(e.responseText)}b.docURL="error.swf"}freepaper2Obj.display(b,f,c)}else{var g="File to open "+m_freepaper2_phpURL+"\n";g+="Error: "+e.status+" "+e.statusText;alert(g)}}};e.open("POST",m_freepaper2_phpURL,true);e.setRequestHeader("Content-Type","application/x-www-form-urlencoded");e.send("docURL="+b.docURL)}},display:function(a,c,b){a.swfURL=a.docURL;delete a.docURL;b.styleclass="freepaper";swfobject.embedSWF(m_freepaper2_swfUrl,b.altContentId,c.width,c.height,"10.0.0.0","swf/expressInstall.swf",a,c,b,this.onEndInstall)},onEndInstall:function(a){if(a.ref==undefined){freepaper2Obj.resetGetFlashPlayer(a.id)}else{freepaper2Obj.setFocusAndListener(a.id+"_ready");freepaper2Obj.freepaperArray[a.ref.name].isReady=true}},resetGetFlashPlayer:function(c){var b=document.getElementById(c);if(b){b.style.backgroundImage="url(images/empty.gif)";var a=b.getElementsByTagName("IMG")[0];a.style.display="block";alert("Download Flash plugin !")}},setFocusAndListener:function(c){var b=document.getElementById(c);function a(d){if(d!=null&&d.preventDefault!=null){d.preventDefault()}return false}if(b.addEventListener==null){b.onmousewheel=a}else{b.addEventListener("DOMMouseScroll",a,false)}},getXhr:function(){var b=null;if(window.XMLHttpRequest){b=new XMLHttpRequest()}else{if(window.ActiveXObject){try{b=new ActiveXObject("Msxml2.XMLHTTP")}catch(a){b=new ActiveXObject("Microsoft.XMLHTTP")}}else{alert("Your browser doesn't support XMLHTTPRequest objects...");b=false}}return b},isReady:function(a){return this.freepaperArray[a].isReady},theReader:function(a){if(navigator.appName.indexOf("Microsoft")!=-1){return window[a]}else{return document[a]}},showInfo:function(a){this.theReader(a).showInfo()},fullScreen:function(a){this.theReader(a).fullScreen()},prevPage:function(a){this.theReader(a).prevPage()},nextPage:function(a){this.theReader(a).nextPage()},zoomPlus:function(a){this.theReader(a).zoomPlus()},zoomMinus:function(a){this.theReader(a).zoomMinus()},setLayout:function(a,b){this.theReader(a).setLayout(b)},onPageChange:function(a,b){if(typeof onPageChange=="function"){onPageChange(a,b)}},onReaderReady:function(a){if(typeof onReaderReady=="function"){onReaderReady(a)}},getCurrPage:function(a){return this.theReader(a).getCurrPage()},getTotalPages:function(a){return this.theReader(a).getTotalPages()},setCurrPage:function(a,b){return this.theReader(a).setCurrPage(b)},getZoom:function(a){return this.theReader(a).getZoom()},setZoom:function(b,a){this.theReader(b).setZoom(a)},fitToPage:function(a){this.theReader(a).fitToPage()},fitToHeight:function(a){this.theReader(a).fitToHeight()},fitToWidth:function(a){this.theReader(a).fitToWidth()},openDocument:function(b,a){var c=document.getElementById(b+"_ready");if(!c){return}var d=this.freepaperArray[b].trace;if(a.substr(a.length-3).toUpperCase()=="SWF"){if((d=="true")||(d==true)){alert("Open input file :\n"+a)}this.theReader(b).openDocument(a)}else{var e=this.getXhr();if(!e){throw new Error("Can't open an xhr session !")}e.onreadystatechange=function(){if(e.readyState==4){if(e.status==200){if((d=="true")||(d==true)){alert(e.responseText)}if(e.responseText.lastIndexOf("EXEC RETURN VALUE : 0")>-1){a+=".swf"}else{if((!d)||(d=="auto")){alert(e.responseText)}a="error.swf"}freepaper2Obj.theReader(b).openDocument(a)}else{var f="File to open "+m_freepaper2_phpURL+"\n";f+="Error: "+e.status+" "+e.statusText;alert(f)}}};e.open("POST",m_freepaper2_phpURL,true);e.setRequestHeader("Content-Type","application/x-www-form-urlencoded");e.send("docURL="+a)}}};